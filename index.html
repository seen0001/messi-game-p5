<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>Messi the GOAT</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.2/p5.min.js"></script>
    <script src="https://molleindustria.github.io/p5.play/lib/p5.play.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Luckiest+Guy&family=Fredoka+One&display=swap');

        html,
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            height: 100%;
            width: 100%;
        }

        #startBtn,
        #restartBtn {
            position: absolute;
            top: 60%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 18px 40px;
            font-size: 2rem;
            font-family: 'Luckiest Guy', 'Fredoka One', cursive, sans-serif;
            background: linear-gradient(90deg, #a50044 0%, #004d98 100%);
            color: #ffcb05;
            border: 4px solid #ffcb05;
            border-radius: 18px;
            box-shadow: 0 8px 24px 0 rgba(0, 0, 0, 0.25), 0 2px 0 #222;
            cursor: pointer;
            z-index: 10;
            letter-spacing: 2px;
            text-shadow: 2px 2px 0 #222, 0 0 8px #ffcb05;
            transition: transform 0.1s, box-shadow 0.1s;
        }

        #startBtn:hover,
        #restartBtn:hover {
            transform: translate(-50%, -50%) scale(1.08) rotate(-2deg);
            box-shadow: 0 12px 32px 0 rgba(0, 0, 0, 0.35), 0 4px 0 #222;
            background: linear-gradient(90deg, #004d98 0%, #a50044 100%);
        }

        #instructions.card {
            position: absolute;
            top: 30%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-2deg);
            background: linear-gradient(135deg, #ffcb05 80%, #a50044 100%);
            border-radius: 24px;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.25), 0 2px 0 #222;
            padding: 36px 48px;
            font-size: 1.3rem;
            z-index: 10;
            text-align: left;
            max-width: 440px;
            display: block;
            border: 6px solid #004d98;
            color: #a50044;
            font-family: 'Fredoka One', 'Luckiest Guy', cursive, sans-serif;
            letter-spacing: 1px;
        }

        #instructions.card h2 {
            color: #004d98;
            font-size: 2.2rem;
            margin-top: 0;
            margin-bottom: 12px;
            text-shadow: 2px 2px 0 #ffcb05, 0 0 8px #a50044;
        }

        #instructions.card ul {
            padding-left: 22px;
        }

        #instructions.card li {
            margin-bottom: 10px;
            font-size: 1.1em;
        }
    </style>
</head>

<body>
    <div id="instructions" class="card">
        <h2>How to Play</h2>
        <ul>
            <li>Move Messi left/right with the arrow keys.</li>
            <li>Catch the balls to score points.</li>
            <li>Don't let them fall past you!</li>
            <li>You have 3 lives. Good luck!</li>
        </ul>
    </div>
    <button id="startBtn" onclick="startGame()">Start</button>
    <button id="restartBtn" onclick="restartGame()">Restart</button>

    <script>
        let player, bold;
        let playerImg, boldImg, backgroundImg;
        let score = 0, lives = 3;
        let gameOver = false;
        let gameState = "start"; // 'start', 'playing', 'gameover', 'paused', 'countdown'
        let pauseVelocities = [];
        let countdownValue = 3;
        let countdownTimer = 0;

        function preload() {
            playerImg = loadImage("images/messi.png");
            boldImg = loadImage("images/fodbold.avif");
            backgroundImg = loadImage("images/fodboldbane.png",
                () => console.log("✅ SVG background loaded"),
                () => console.warn("⚠️ SVG background failed to load properly"));
        }

        function setup() {
            createCanvas(document.documentElement.clientWidth, document.documentElement.clientHeight);
            showStartUI();
        }

        function showStartUI() {
            document.getElementById("startBtn").style.display = "block";
            document.getElementById("instructions").style.display = "block";
            document.getElementById("restartBtn").style.display = "none";
        }

        function hideStartUI() {
            document.getElementById("startBtn").style.display = "none";
            document.getElementById("instructions").style.display = "none";
        }

        function startGame() {
            gameState = "playing";
            hideStartUI();
            setupGame();
        }

        function setupGame() {
            score = 0;
            lives = 3;
            gameOver = false;
            // Remove old player sprite if exists
            if (player) {
                player.remove();
                player = undefined;
            }
            // Remove all old bold sprites if exists
            if (bold) {
                for (let i = 0; i < bold.length; i++) {
                    bold[i].remove();
                }
                bold.removeSprites();
                bold = undefined;
            }
            document.getElementById("restartBtn").style.display = "none";

            player = createSprite(width / 2, height - 120, 120, 120);
            if (playerImg) player.addImage(playerImg);
            player.scale = 0.1;

            bold = new Group();
            for (let i = 0; i < 3; i++) {
                let m = createSprite(random(20, width - 20), random(-500, -50), 30, 30);
                if (boldImg) {
                    m.addImage(boldImg);
                    m.scale = 0.15;
                } else {
                    m.shapeColor = color(255, 215, 0);
                }
                m.velocity.y = random(3, 5);
                bold.add(m);
            }
        }

        function draw() {
            try {
                if (backgroundImg) {
                    background(backgroundImg);
                } else {
                    drawGradientBackground();
                }
            } catch (e) {
                console.warn("⚠️ Failed to draw SVG background, using gradient fallback");
                drawGradientBackground();
            }

            if (gameState === "start") {
                // Show start UI, nothing else
                return;
            }

            // Always show score, lives, and pause instruction except on start and gameover
            if (gameState !== "start" && gameState !== "gameover") {
                textFont('Luckiest Guy, Fredoka One, cursive');
                fill('#ffcb05'); // Barcelona yellow
                stroke('#004d98'); // Barcelona blue outline
                strokeWeight(4);
                textSize(32);
                textAlign(LEFT, TOP);
                // Shadow effect
                drawingContext.shadowColor = '#a50044';
                drawingContext.shadowBlur = 8;
                text("Score: " + score, 10, 20);
                text("Lives: " + lives, 10, 60);
                // Pause instruction
                textSize(18);
                strokeWeight(2);
                fill('#004d98');
                stroke('#ffcb05');
                drawingContext.shadowColor = '#fff';
                drawingContext.shadowBlur = 4;
                text("Press ESC to pause/resume", 12, 105);
                // Reset shadow for other text
                drawingContext.shadowBlur = 0;
                strokeWeight(1);
            }

            if (gameState === "playing" && !gameOver) {
                if (keyIsDown(LEFT_ARROW)) player.position.x -= 12;
                if (keyIsDown(RIGHT_ARROW)) player.position.x += 12;
                player.position.x = constrain(player.position.x, 30, width - 30);

                for (let i = 0; i < bold.length; i++) {
                    let m = bold[i];
                    if (m.position.y > height) {
                        m.position.y = random(-200, -50);
                        m.position.x = random(20, width - 20);
                        lives--;
                        if (lives <= 0) {
                            gameOver = true;
                            gameState = "gameover";
                            document.getElementById("restartBtn").style.display = "block";
                        }
                    }

                    if (player.overlap(m)) {
                        score++;
                        m.position.y = random(-200, -50);
                        m.position.x = random(20, width - 20);
                    }
                }

                drawSprites();
            } else if (gameState === "gameover") {
                // Cartoony Barcelona style for Game Over and Final Score
                textFont('Luckiest Guy, Fredoka One, cursive');
                fill('#ffcb05');
                stroke('#004d98');
                strokeWeight(6);
                textAlign(CENTER, CENTER);
                drawingContext.shadowColor = '#a50044';
                drawingContext.shadowBlur = 16;
                textSize(64);
                text("Game Over", width / 2, height / 2 - 60);
                textSize(36);
                text("Final Score: " + score, width / 2, height / 2 + 10);
                // Reset shadow for other text
                drawingContext.shadowBlur = 0;
                strokeWeight(1);
            } else if (gameState === "paused") {
                // Draw paused overlay
                textFont('Luckiest Guy, Fredoka One, cursive');
                fill('#ffcb05');
                stroke('#004d98');
                strokeWeight(8);
                textAlign(CENTER, CENTER);
                drawingContext.shadowColor = '#a50044';
                drawingContext.shadowBlur = 18;
                textSize(80);
                text("Paused", width / 2, height / 2 - 40);
                textSize(28);
                strokeWeight(3);
                fill('#004d98');
                stroke('#ffcb05');
                drawingContext.shadowColor = '#fff';
                drawingContext.shadowBlur = 4;
                text('Press "esc" to resume', width / 2, height / 2 + 40);
            } else if (gameState === "countdown") {
                // Countdown overlay
                let elapsed = Math.floor((millis() - countdownTimer) / 1000);
                let showValue = countdownValue - elapsed;
                if (showValue > 0) {
                    textFont('Luckiest Guy, Fredoka One, cursive');
                    fill('#ffcb05');
                    stroke('#004d98');
                    strokeWeight(8);
                    textAlign(CENTER, CENTER);
                    drawingContext.shadowColor = '#a50044';
                    drawingContext.shadowBlur = 18;
                    textSize(80);
                    text(showValue, width / 2, height / 2);
                } else {
                    // Restore velocities and resume
                    for (let i = 0; i < bold.length; i++) {
                        bold[i].velocity.y = pauseVelocities[i] || random(3, 5);
                    }
                    gameState = "playing";
                }
            }
        }

        function restartGame() {
            gameState = "playing";
            setupGame();
        }

        function windowResized() {
            resizeCanvas(document.documentElement.clientWidth, document.documentElement.clientHeight);
        }

        function keyPressed() {
            if ((keyCode === ENTER || key === 'Enter')) {
                if (gameState === "gameover") {
                    restartGame();
                } else if (gameState === "start") {
                    startGame();
                }
            }
            if (keyCode === ESCAPE || key === 'Escape') {
                if (gameState === "playing") {
                    // Store velocities and pause balls
                    pauseVelocities = [];
                    for (let i = 0; i < bold.length; i++) {
                        pauseVelocities[i] = bold[i].velocity.y;
                        bold[i].velocity.y = 0;
                    }
                    gameState = "paused";
                } else if (gameState === "paused") {
                    // Start countdown
                    countdownValue = 3;
                    countdownTimer = millis();
                    gameState = "countdown";
                }
            }
        }
    </script>
</body>

</html>